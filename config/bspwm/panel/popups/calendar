#!/usr/bin/env bash

# Change to the current directory
cd $(dirname $0)

readonly ID="calendar"

DATE="$(date)"
DAY="$(echo "$DATE" | awk '{print $3}')"
MONTH="$(echo "$DATE" | awk '{print $2}')"

CALENDAR="$(cal)"

IFS=''
newline=$'\n'
result=""
while read line; do
    found=false
    if ! echo "$line" | grep -q '[[:alpha:]]'; then
        IFS=' '
        for number in $line; do
            if [[ $number -eq $DAY ]]; then
                found=true
            fi
        done
        IFS=''
    fi
    
    if [ "$found" = true ]; then
        result="${result}$(echo "$line" | sed "s/$DAY/^bg(#AF865A)^fg(#4A3637) ${DAY} ^fg()^bg()/")${newline}"
    else
        result="${result}${line}${newline}"
    fi
done <<< "$CALENDAR"

# Strip off extra newline.
result="$(echo -n "$result")"

SCREEN_WIDTH=$(xrandr | grep -E '[0-9]+x[0-9]+.*\*' | cut -d x -f1)
./popup --id "$ID" --text "$result" --width 200 -x $(($SCREEN_WIDTH - 200 - 7))
